<!doctype html>
<html >
    <head>

        <!-- <meta name="viewport" content="width=device-width, initial-scale=1.0" /> -->
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=0">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta http-equiv="Content-Style-Type" content="text/css" />

        <link rel="preconnect" href="https://rsms.me/">
        <link rel="stylesheet" href="https://rsms.me/inter/inter.css">
        <link rel="stylesheet" type="text/css" href="/style.css" />

                        <title>  virtual_dom</title>
                        <style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    background-color: #2a211c;
    color: #bdae9d;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #bdae9d;  padding-left: 4px; }
div.sourceCode
  { color: #eceff4;  }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ffff00; } /* Alert */
code span.an { color: #88c0d0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { } /* Attribute */
code span.bn { color: #a3be8c; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #bf616a; font-weight: bold; } /* ControlFlow */
code span.ch { color: #a3be8c; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #88c0d0; font-weight: bold; font-style: italic; } /* Comment */
code span.do { color: #88c0d0; font-style: italic; } /* Documentation */
code span.dt { text-decoration: underline; } /* DataType */
code span.dv { color: #a3be8c; } /* DecVal */
code span.er { color: #ffff00; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #a3be8c; } /* Float */
code span.fu { color: #ff9358; font-weight: bold; } /* Function */
code span.im { } /* Import */
code span.in { color: #88c0d0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #bf616a; font-weight: bold; } /* Keyword */
code span.op { } /* Operator */
code span.pp { font-weight: bold; } /* Preprocessor */
code span.sc { color: #a3be8c; } /* SpecialChar */
code span.ss { color: #a3be8c; } /* SpecialString */
code span.st { color: #a3be8c; } /* String */
code span.va { } /* Variable */
code span.vs { color: #a3be8c; } /* VerbatimString */
code span.wa { color: #ffff00; font-weight: bold; } /* Warning */
        </style>
                                    </head>
    <body>


                <div class="navbar navbar-static-top">
            <div class="navbar-inner">
                <div class="container">
                    <span class="doc-title">
                        <span id="bonsai">bonsai</span> 
                        <span id="slash"> / </span> 
                         virtual_dom
                    </span>
                    <ul class="nav pull-right doc-info">
                                                                    </ul>
                </div>
            </div>
        </div>
                <div class="container">
            <div class="row">
                <div class="toc_and_chapters">
                                        <div id="TOC" class="span3">
                        <h3> This chapter</h3>
                        <div class="well toc">

                            <ul>
                            <li><a href="#vdom.node.t"
                            id="toc-vdom.node.t">Vdom.Node.t</a></li>
                            <li><a href="#vdom.attr.t"
                            id="toc-vdom.attr.t">Vdom.Attr.t</a></li>
                            <li><a href="#unit-vdom.effect.t"
                            id="toc-unit-vdom.effect.t">unit
                            Vdom.Effect.t</a></li>
                            <li><a href="#the-underlying-machinery"
                            id="toc-the-underlying-machinery">The
                            Underlying Machinery</a></li>
                            </ul>

                        </div>
                    </div>
                                        <div id="chapters" class="span3">
                        <h3> All chapters </h3>
                        <ul>
                        <li><a href="./00-introduction.html">  introduction </a></li>
                        <li><a href="./01-virtual_dom.html">  virtual_dom </a></li>
                        <li><a href="./02-dynamism.html">  dynamism </a></li>
                        <li><a href="./03-state.html">  state </a></li>
                        <li><a href="./04-forms.html">  forms </a></li>
                        <li><a href="./05-effect.html">  effect </a></li>
                        <li><a href="./07-flow.html">  flow </a></li>
                        <li><a href="./08-css.html">  css </a></li>
                        <li><a href="./09-edge-triggering.html">  edge triggering </a></li>
                        </ul>                    </div>
                </div>
                <div class="span9">
                                        <p>Browser interfaces are
                                        described by a tree of HTML
                                        <em>elements</em>, each of which
                                        can have some
                                        <em>attributes</em> attached.
                                        The <code>virtual_dom</code>
                                        library provides an OCaml
                                        interface for constructing these
                                        trees.</p>
                                        <h1
                                        id="vdom.node.t">Vdom.Node.t</h1>
                                        <p>This wouldn’t be a
                                        programming tutorial without a
                                        hello world example, which
                                        introduces the
                                        <code>Vdom.Node.text</code> node
                                        constructor.</p>
                                        <!-- $MDX file=../../examples/bonsai_guide_code/vdom_examples.ml,part=hello_world -->
                                        <div class="sourceCode"
                                        id="cb1"><pre
                                        class="sourceCode ocaml"><code class="sourceCode ocaml"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> hello_world : Vdom.Node.t = Vdom.Node.text <span class="st">&quot;hello world!&quot;</span></span></code></pre></div>
                                        <iframe data-external="1" src="./out#hello_world">
                                        </iframe>
                                        <p>The text node will frequently
                                        be the “leaf” of a view (there
                                        are no “children” of a text
                                        node). Let’s put some text
                                        inside a bulleted list by using
                                        some more node constructors:</p>
                                        <!-- $MDX file=../../examples/bonsai_guide_code/vdom_examples.ml,part=bulleted_list -->
                                        <div class="sourceCode"
                                        id="cb2"><pre
                                        class="sourceCode ocaml"><code class="sourceCode ocaml"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> bulleted_list : Vdom.Node.t =</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> <span class="kw">open</span> Vdom.Node <span class="kw">in</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  div</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    [ h3 [ text <span class="st">&quot;Norwegian Pancakes&quot;</span> ]</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    ; ul</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>        [ li [ text <span class="st">&quot;3 eggs&quot;</span> ]</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>        ; li [ text <span class="st">&quot;2 cups of milk&quot;</span> ]</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>        ; li [ text <span class="st">&quot;1 cup of flour&quot;</span> ]</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>;;</span></code></pre></div>
                                        <iframe data-external="1" src="./out#bulleted_list">
                                        </iframe>
                                        <p>For the bulleted list, the
                                        <code>ul</code> and
                                        <code>li</code> functions are
                                        required. These correspond to
                                        the <a
                                        href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/ul">ul
                                        element</a> and the <a
                                        href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/li">li
                                        element</a>, which MDN helpfully
                                        tells us stands for
                                        <u>U</u>nordered <u>L</u>ist and
                                        <u>L</u>ist <u>I</u>tem.</p>
                                        <p><code>h3</code> is short for
                                        “header level 3”, and is
                                        responsible for the larger font
                                        in the title text, and
                                        <code>div</code> is a <a
                                        href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/div">“content
                                        division”</a> and serves as a
                                        useful wrapper for the rest of
                                        the content.</p>
                                        <aside>
                                        <p>There is a
                                        <code>Vdom.Node.*</code> node
                                        constructor function for
                                        <em>almost</em> every <a
                                        href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element">dom
                                        node</a>. If a constructor is
                                        missing,
                                        <code>Vdom.Node.create</code> is
                                        available to manually specify
                                        the tag, but the
                                        <code>Virtual_dom</code>
                                        maintainers gladly accept
                                        contributions back to the main
                                        library!</p>
                                        </aside>
                                        <h1
                                        id="vdom.attr.t">Vdom.Attr.t</h1>
                                        <p>An optional argument to the
                                        <code>Vdom.Node.*</code>
                                        constructor functions is a
                                        <code>Vdom.Attr.t list</code>.
                                        These <code>Attr.t</code>
                                        correspond to <a
                                        href="https://developer.mozilla.org/en-US/docs/Web/HTML/Attributes">DOM
                                        attributes</a>, <a
                                        href="https://developer.mozilla.org/en-US/docs/Web/API/Element#properties">DOM
                                        properties</a>, and <a
                                        href="https://developer.mozilla.org/en-US/docs/Web/Guide/Events/Event_handlers">DOM
                                        event_handlers</a>.</p>
                                        <p>Attributes can be used to
                                        tweak the appearance and
                                        behavior of the nodes that they
                                        are attached to, for instance,
                                        by adding placeholder text to a
                                        textbox:</p>
                                        <!-- $MDX file=../../examples/bonsai_guide_code/vdom_examples.ml,part=input_placeholder -->
                                        <div class="sourceCode"
                                        id="cb3"><pre
                                        class="sourceCode ocaml"><code class="sourceCode ocaml"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> input_placeholder : Vdom.Node.t =</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  Vdom.Node.<span class="dt">input</span> ~attr:(Vdom.Attr.placeholder <span class="st">&quot;placeholder text here&quot;</span>) ()</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>;;</span></code></pre></div>
                                        <iframe data-external="1" src="./out#input_placeholder">
                                        </iframe>
                                        <p>Or coloring text with inline
                                        css:</p>
                                        <!-- $MDX file=../../examples/bonsai_guide_code/vdom_examples.ml,part=css_gen -->
                                        <div class="sourceCode"
                                        id="cb4"><pre
                                        class="sourceCode ocaml"><code class="sourceCode ocaml"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> css_gen : Vdom.Node.t =</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  Vdom.Node.span</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    ~attr:(Vdom.Attr.style (Css_gen.color (`Name <span class="st">&quot;red&quot;</span>)))</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    [ Vdom.Node.text <span class="st">&quot;this text is red&quot;</span> ]</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>;;</span></code></pre></div>
                                        <iframe data-external="1" src="./out#css_gen">
                                        </iframe>
                                        <p><a href="./08-css.html">The
                                        8th chapter “css”</a> goes into
                                        much more depth on the styling
                                        attributes.</p>
                                        <p>Finally, there are “event
                                        handler” attributes which
                                        register functions that are
                                        called when a user interacts
                                        with the element (like clicking
                                        on buttons or typing into a text
                                        box).</p>
                                        <!-- $MDX file=../../examples/bonsai_guide_code/vdom_examples.ml,part=clicky_button -->
                                        <div class="sourceCode"
                                        id="cb5"><pre
                                        class="sourceCode ocaml"><code class="sourceCode ocaml"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> clicky : Vdom.Node.t =</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  Vdom.Node.button</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    ~attr:</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>      (Vdom.Attr.on_click (<span class="kw">fun</span> (_evt : mouse_event) -&gt;</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>         alert <span class="st">&quot;hello there!&quot;</span>;</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>         Ui_effect.Ignore))</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    [ Vdom.Node.text <span class="st">&quot;click me!&quot;</span> ]</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>;;</span></code></pre></div>
                                        <iframe data-external="1" src="./out#clicky_button">
                                        </iframe>
                                        <p>These functions usually
                                        receive a browser-level event
                                        value (ignored in the above
                                        example as <code>_evt</code>)
                                        alongside any useful data
                                        extracted from that event. For
                                        example, see the following
                                        event-handler attributes for
                                        mouse-clicks and typing into a
                                        textbox:</p>
                                        <p><code>val Vdom.Attr.on_click : (mouse_event -&gt; unit Vdom.Effect.t) -&gt; Vdom.Attr.t val Vdom.Attr.on_input : (input_event -&gt; string -&gt; unit Vdom.Effect.t) -&gt; Vdom.Attr.t</code></p>
                                        <p>You’ll notice that because
                                        <code>on_input</code> is used to
                                        respond to users typing into a
                                        textbox, the handler function is
                                        also given a string that holds
                                        the current contents of that
                                        textbox.</p>
                                        <p>The browser-level
                                        event-values like
                                        <code>mouse_event</code> and
                                        <code>input_event</code> are
                                        almost always ignored in Bonsai
                                        apps.</p>
                                        <p>The return type for these
                                        event handler functions is
                                        <code>unit Vdom.Effect.t</code>,
                                        which is the final type that we
                                        care about in the
                                        <code>Virtual_dom</code>
                                        library.</p>
                                        <h1 id="unit-vdom.effect.t">unit
                                        Vdom.Effect.t</h1>
                                        <p>In the example above, the
                                        <code>on_click</code> handler
                                        function returned
                                        <code>Vdom.Effect.Ignore</code>.
                                        However, the alert definitely
                                        fires when you click on it, so
                                        what is this value doing, and
                                        why must these event-handlers
                                        return values of type
                                        <code>unit Vdom.Effect.t</code>
                                        in the first place?</p>
                                        <p>In reality, values of type
                                        <code>unit Vdom.Effect.t</code>
                                        are used to schedule work on
                                        Bonsai’s event-queue.
                                        <code>Vdom.Effect.Ignore</code>
                                        is the no-op event, and it
                                        schedules no work on the
                                        event-queue.
                                        <code>Vdom.Effect.Many [a; b; c]</code>
                                        wraps up multiple events,
                                        scheduling them all in
                                        order.</p>
                                        <p>That leaves us with two more
                                        question:</p>
                                        <ol type="1">
                                        <li>How do I get values of type
                                        <code>unit Vdom.Effect.t</code>
                                        that aren’t just
                                        <code>Ignore</code> and
                                        <code>Many</code></li>
                                        <li>Why would I want to use the
                                        Bonsai event queue anyway?</li>
                                        </ol>
                                        <p>Both of which will be
                                        answered in <a
                                        href="./03-state.html">Bonsai
                                        Guide Part 3: State</a>.</p>
                                        <aside>
                                        <p><code>unit Vdom.Effect.t</code>
                                        is actually an alias for
                                        <code>unit Ui_effect.t</code>.
                                        They are the same type, and it’s
                                        merely re-exported from the
                                        <code>Vdom</code> library as a
                                        convenience. If you see a
                                        <code>unit Ui_effect.t</code>
                                        (either in another library, or
                                        from merlin), know that it is
                                        the same thing as
                                        <code>unit Vdom.Effect.t</code>.</p>
                                        </aside>
                                        <h1
                                        id="the-underlying-machinery">The
                                        Underlying Machinery</h1>
                                        <p>A virtual-DOM is an immutable
                                        tree of immutable UI elements
                                        that represents the view of the
                                        application at a point in time.
                                        This is in contrast to <a
                                        href="https://developer.mozilla.org/en-US/docs/Web/API/Document_Object_Model">the
                                        DOM (Document Object Model)</a>,
                                        which is a mutable tree of
                                        mutable UI elements.</p>
                                        <aside>
                                        <p>The term “virtual-DOM” is not
                                        unique to Bonsai. Many other UI
                                        libraries like <a
                                        href="https://reactjs.org/docs/faq-internals.html">React</a>,
                                        <a
                                        href="https://github.com/elm/virtual-DOM">Elm</a>,
                                        and <a
                                        href="https://vuejs.org/v2/guide/render-function.html#The-Virtual-DOM">Vue</a>
                                        have their own “virtual-DOM”
                                        libraries that all share similar
                                        goals.</p>
                                        </aside>
                                        <p>With the (not-virtual) DOM,
                                        the program mutates the tree of
                                        UI components in order to update
                                        the view, but with the
                                        virtual-DOM, the program
                                        produces a new tree every time
                                        the view changes. While this may
                                        appear to be a performance
                                        nightmare, many of the tools
                                        that we use to reduce
                                        duplication of work in regular
                                        programs also work well to
                                        prevent re-computing parts of
                                        this sub-view.</p>
                                        <p>The <code>Virtual_dom</code>
                                        library also contains functions
                                        that diff two versions of a
                                        virtual-dom tree. The diff can
                                        be used as instructions for
                                        mutating the DOM to reflect the
                                        contents of the “next”
                                        virtual-DOM node. These
                                        functions are quite fundamental,
                                        but Bonsai handles the calls to
                                        these functions, so application
                                        developers are solely concerned
                                        with producing new vdom
                                        trees.</p>
                                        <p>Let’s continue to <a
                                        href="./02-dynamism.html">Bonsai
                                        Guide Part 2: Dynamism</a>.</p>
                                    </div>
            </div>
        </div>
        <!-- <script src="https://vjs.zencdn.net/5.4.4/video.js"></script> -->

    </body>
</html>
